<!DOCTYPE html>
<html lang="ru">
<head>
  <title>–†—É–ª–µ—Ç–∫–∞ –°—Ç–æ–ª</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { background: #000; color: #FFF; font-family: Arial; text-align: center; padding: 10px; }
    .table { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; max-width: 300px; margin: 20px auto; }
    .cell { background: #333; border: 1px solid #666; padding: 10px; cursor: pointer; border-radius: 5px; }
    .cell:hover { background: #FFA500; }
    .zero { background: #00FF00; grid-column: 1 / -1; } /* 0 –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é —Å—Ç—Ä–æ–∫—É */
    .history { margin: 20px; font-size: 12px; overflow: auto; max-height: 100px; }
    .top3 { margin: 20px; font-size: 16px; background: #222; padding: 10px; border-radius: 5px; }
    button { background: #FFA500; color: #000; border: none; padding: 10px 20px; margin: 5px; border-radius: 5px; cursor: pointer; }
    button:hover { background: #FF8C00; }
  </style>
</head>
<body>
  <h1>üé∞ –°—Ç–æ–ª –†—É–ª–µ—Ç–∫–∏</h1>
  <p>–ö–ª–∏–∫–Ω–∏ —á–∏—Å–ª–æ ‚Äî –¥–æ–±–∞–≤—å –≤ –∏—Å—Ç–æ—Ä–∏—é (–æ–±–Ω–æ–≤–∏—Ç –±–∞–∑—É –±–æ—Ç–∞)</p>
  <div class="table" id="table"></div>
  <div class="history">
    –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10: <span id="histList"></span>
  </div>
  <div class="top3" id="top3">–¢–æ–ø-3 –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ: ...</div>
  <button onclick="analyze()">–ê–Ω–∞–ª–∏–∑</button>
  <button onclick="clearHistory()">–û—á–∏—Å—Ç–∏—Ç—å</button>

  <script>
    const WebApp = Telegram.WebApp;
    WebApp.ready();
    WebApp.expand();

    let history = [];
    const WORKER_URL = 'https://analiz-bot.zaugoldima.workers.dev';  // –¢–≤–æ–π Worker URL

    // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å—Ç–æ–ª —Ä—É–ª–µ—Ç–∫–∏ (3 —Ä—è–¥–∞, 0 —Å–≤–µ—Ä—Ö—É)
    const numbers = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
    const table = document.getElementById('table');
    numbers.forEach(num => {
      const cell = document.createElement('div');
      cell.className = num === 0 ? 'cell zero' : 'cell';
      cell.textContent = num;
      cell.onclick = () => addNumber(num);
      table.appendChild(cell);
    });

    function addNumber(num) {
      const normalized = num === 0 ? '00' : num.toString().padStart(2, '0');
      history.push(normalized);
      updateHistory();
      // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å –±–æ—Ç–æ–º (Worker)
      fetch(WORKER_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'add_number', number: normalized })
      }).then(r => r.json()).then(data => {
        if (data.success) WebApp.showAlert(`–î–æ–±–∞–≤–ª–µ–Ω–æ: ${num} (–±–∞–∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞)`);
      });
    }

    function updateHistory() {
      document.getElementById('histList').textContent = history.slice(-10).join(' ');
    }

    async function analyze() {
      const response = await fetch(WORKER_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'get_top_after_last' })
      });
      const data = await response.json();
      if (data.top) {
        document.getElementById('top3').innerHTML = `–¢–æ–ø-3 –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ: ${data.top.map(([n, c]) => `${n} (${c})`).join(', ')} (–≤—Å–µ–≥–æ: ${data.total})`;
      } else {
        document.getElementById('top3').textContent = '–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.';
      }
    }

    async function clearHistory() {
      history = [];
      updateHistory();
      await fetch(WORKER_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'clear_history' })
      });
      WebApp.showAlert('–ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞!');
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑ Worker –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    fetch(WORKER_URL, { method: 'GET' }).then(r => r.json()).then(data => {
      history = data.history || [];
      updateHistory();
    });
  </script>
</body>
</html>
